{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h2>Planning des congés</h2>
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <!-- Formulaire -->
    <form method="post" class="mb-4">
        {% csrf_token %}
        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="start_date">Date de début :</label>
                <input type="date" id="start_date" name="start_date" class="form-control" value="{{ start_date|date:'Y-m-d' }}" required>
            </div>
            <div class="form-group col-md-4">
                <label for="end_date">Date de fin :</label>
                <input type="date" id="end_date" name="end_date" class="form-control" value="{{ end_date|date:'Y-m-d' }}" required>
            </div>
            <div class="form-group col-md-4 align-self-end">
                <button type="submit" class="btn btn-primary">Générer le planning</button>
            </div>
        </div>
    </form>

    <!-- Calendrier FullCalendar -->
    <div id="calendar"></div>
</div>

<!-- Inclure FullCalendar -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            events: function(fetchInfo, successCallback, failureCallback) {
                var startDate = document.getElementById('start_date').value;
                var endDate = document.getElementById('end_date').value;
                fetch(`/responsablerh/leave-events/?start_date=${startDate}&end_date=${endDate}`)
                    .then(response => response.json())
                    .then(data => successCallback(data))
                    .catch(error => failureCallback(error));
            },
            eventClick: function(info) {
                alert('Congé de ' + info.event.title + ' du ' + info.event.startStr + ' au ' + info.event.endStr);
            }
        });
        calendar.render();
    });
</script>

<style>
#calendar {
    max-width: 1100px;
    margin: 0 auto;
}
</style>
{% endblock %}